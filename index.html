<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Baccarat Prediction Youth</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h2>ЁЯУШ р╕кр╕╣р╕Хр╕гр╕Бр╕▓р╕гр╕Чр╕│р╕Щр╕▓р╕в</h2>
    <ul>
      <li>р╕кр╕╣р╕Хр╕гр╕Хр╕▒р╕зр╕Щр╣Йр╕нр╕вр╕кр╕╕р╕Ф: р╕лр╕▓р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕Хр╕▒р╕зр╕Щр╣Йр╕нр╕вр╕кр╕╕р╕Фр╣Гр╕Щр╣Ар╕Др╣Йр╕▓р╣Др╕Юр╣Ир╕лр╕ер╕▒р╕Б р╣Ар╕Чр╕╡р╕вр╕Ър╕Бр╕▒р╕Ър╕гр╕нр╕З р╕Хр╕гр╕Зр╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕З
        <ul><li>р╣Ар╕лр╕бр╕╖р╕нр╕Щр╕Бр╕▒р╕Щ тЖТ р╕Чр╕▓р╕в P</li><li>р╕Хр╣Ир╕▓р╕Зр╕Бр╕▒р╕Щ тЖТ р╕Чр╕▓р╕в B</li></ul>
      </li>
      <li>р╕кр╕╣р╕Хр╕гр╕Хр╕▒р╕зр╕бр╕▓р╕Бр╕кр╕╕р╕Ф (р╣Гр╕лр╕бр╣И): р╕лр╕▓р╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕Хр╕▒р╕зр╕бр╕▓р╕Бр╕кр╕╕р╕Фр╣Гр╕Щр╕лр╕ер╕▒р╕Б тЖТ р╕Фр╕╣р╕Др╣Ир╕▓р╕Чр╕╡р╣Ир╕Хр╕│р╣Бр╕лр╕Щр╣Ир╕Зр╕Щр╕▒р╣Йр╕Щр╣Гр╕Щр╕гр╕нр╕З
        <ul>
          <li>р╕Цр╣Йр╕▓р╕Др╣Ир╕▓р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Фр╣Гр╕Щр╕лр╕ер╕▒р╕Бр╣Ар╕лр╕бр╕╖р╕нр╕Щр╕Бр╕▒р╕Щр╕лр╕бр╕Ф & р╣Гр╕Щр╕гр╕нр╕Зр╣Ар╕лр╕бр╕╖р╕нр╕Щр╕Бр╕▒р╕Щр╕лр╕бр╕Ф</li>
          <li>р╕Цр╣Йр╕▓р╕Др╣Ир╕▓р╕Вр╕нр╕Зр╕лр╕ер╕▒р╕Бр╕Бр╕▒р╕Ър╕гр╕нр╕З (р╕Хр╕▒р╕зр╕нр╕вр╣Ир╕▓р╕Зр╣Бр╕гр╕Б) **р╣Др╕бр╣Ир╣Ар╕лр╕бр╕╖р╕нр╕Щр╕Бр╕▒р╕Щ** тЖТ р╣Бр╕Чр╕З P</li>
          <li>р╕Цр╣Йр╕▓р╣Ар╕лр╕бр╕╖р╕нр╕Щр╕Бр╕▒р╕Щ тЖТ р╣Бр╕Чр╕З B</li>
          <li>р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕Др╕гр╕Ър╣Ар╕Зр╕╖р╣Ир╕нр╕Щр╣Др╕В тЖТ р╣Бр╕Чр╕З B</li>
        </ul>
      </li>
      <li>р╕Цр╣Йр╕▓р╣Ар╕Др╣Йр╕▓р╣Др╕Юр╣Ир╕лр╕ер╕▒р╕Бр╣Ар╕лр╕бр╕╖р╕нр╕Щр╕Бр╕▒р╕Щр╕лр╕бр╕Ф р╣Гр╕Кр╣Йр╣Ар╕Др╣Йр╕▓р╣Др╕Юр╣Ир╕гр╕нр╕Зр╣Бр╕Чр╕Щ</li>
    </ul>
    <hr>
    <label>р╕Бр╕гр╕нр╕Бр╣Ар╕Др╣Йр╕▓р╣Др╕Юр╣И 6 р╕Хр╕▒р╕з (p/b/p/b/p/b р╕лр╕гр╕╖р╕н pbpbpb):</label>
    <input id="combinedInput" type="text" placeholder="р╣Ар╕Кр╣Ир╕Щ pbpppb р╕лр╕гр╕╖р╕н p/b/p/p/p/b">
    <button class="btn-analyze" onclick="analyze()">ЁЯФН р╕Чр╕│р╕Щр╕▓р╕в</button>
    <div id="predictionResult" class="prediction-summary"></div>
    <div class="btn-group">
      <button class="btn-result" onclick="submitResult('P')">тЬФ р╕Ьр╕ер╕Ир╕гр╕┤р╕З P</button>
      <button class="btn-result banker" onclick="submitResult('B')">тЬФ р╕Ьр╕ер╕Ир╕гр╕┤р╕З B</button>
      <button class="btn-result tie" onclick="submitResult('T')">тЬФ р╕Ьр╕ер╕Ир╕гр╕┤р╕З T</button>
      <button class="btn-control" onclick="undoDNA()">тЖй р╕вр╣Йр╕нр╕Щр╕Бр╕ер╕▒р╕Ъ</button>
    </div>
    <div class="dna-box">
      <h3>ЁЯзм р╕кр╕Цр╕┤р╕Хр╕┤ DNA</h3>
      <div class="btn-group">
        <button class="btn-control" onclick="clearDNA()">ЁЯз╣ р╕ер╣Йр╕▓р╕З DNA</button>
      </div>
      <p class="dna-label">р╕кр╕╣р╕Хр╕гр╕Хр╕▒р╕зр╕Щр╣Йр╕нр╕вр╕кр╕╕р╕Ф:</p> <div id="dna1">-</div> <div id="percent1" class="percent-box">-</div>
      <p class="dna-label">р╕кр╕╣р╕Хр╕гр╕Хр╕▒р╕зр╕бр╕▓р╕Бр╕кр╕╕р╕Ф:</p> <div id="dna2">-</div> <div id="percent2" class="percent-box">-</div>
    </div>
  </div>
  <script>
    let dna1 = [], dna2 = [], backupDNA = [];
    window.onload = () => {
      const saved = localStorage.getItem('dnaBackup');
      if (saved) {
        const { dna1: d1, dna2: d2 } = JSON.parse(saved);
        dna1 = d1 || []; dna2 = d2 || [];
        renderDNA();
      }
    };
    function getAllMaxPositions(arr) {
      const count = {};
      arr.forEach((v, i) => count[v] ? count[v].push(i) : count[v] = [i]);
      const maxCount = Math.max(...Object.values(count).map(pos => pos.length));
      const maxKeys = Object.keys(count).filter(k => count[k].length === maxCount);
      let positions = [];
      maxKeys.forEach(k => positions = positions.concat(count[k]));
      return positions;
    }
    function isAllSame(arr) {
      return arr.every(x => x === arr[0]);
    }
    function getMinOrMaxPos(arr, mode='min') {
      const count = {};
      arr.forEach((v,i)=> count[v]?count[v].push(i):count[v]=[i]);
      const sorted = Object.entries(count).sort((a,b)=>(mode==='min'? a[1].length-b[1].length : b[1].length-a[1].length));
      return sorted[0][1][0];
    }
    function analyze(){
      let input = document.getElementById('combinedInput').value.trim().toLowerCase();
      let raw = input.includes('/')?input.split('/') : input.split('');
      if(raw.length!==6){ document.getElementById('predictionResult').innerText='тЭМ р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╣Гр╕лр╣Йр╕Др╕гр╕Ъ 6 р╕Хр╕▒р╕з'; return; }
      let main=raw.slice(0,3), ref=raw.slice(3);
      if(isAllSame(main)) [main, ref] = [ref, main];
      // р╕Хр╕▒р╕зр╕бр╕▓р╕Бр╕кр╕╕р╕Ф (р╣Гр╕лр╕бр╣И)
      const maxPosArr = getAllMaxPositions(main);
      const mainMaxValues = maxPosArr.map(idx => main[idx]);
      const refMaxValues = maxPosArr.map(idx => ref[idx]);
      let maxResult = "-";
      if(isAllSame(mainMaxValues) && isAllSame(refMaxValues)) {
        maxResult = (mainMaxValues[0] !== refMaxValues[0]) ? "P" : "B";
      } else {
        maxResult = "B";
      }
      // р╕Хр╕▒р╕зр╕Щр╣Йр╕нр╕вр╕кр╕╕р╕Ф
      const minPos=getMinOrMaxPos(main,'min');
      const minResult = main[minPos]===ref[minPos]?'P':'B';
      document.getElementById('predictionResult').innerHTML=`тЬЕ р╕Хр╕▒р╕зр╕Щр╣Йр╕нр╕вр╕кр╕╕р╕Ф:<strong>${minResult}</strong> | р╕Хр╕▒р╕зр╕бр╕▓р╕Бр╕кр╕╕р╕Ф:<strong>${maxResult}</strong>`;
      new Audio('https://freesound.org/data/previews/341/341695_6261194-lq.mp3').play();
    }
    function submitResult(actual){
      let input=document.getElementById('combinedInput').value.trim().toLowerCase();
      let raw=input.includes('/')?input.split('/') : input.split('');
      if(raw.length!==6)return;
      let main=raw.slice(0,3), ref=raw.slice(3);
      if(isAllSame(main)) [main, ref] = [ref, main];
      const maxPosArr = getAllMaxPositions(main);
      const mainMaxValues = maxPosArr.map(idx => main[idx]);
      const refMaxValues = maxPosArr.map(idx => ref[idx]);
      let maxResult = "-";
      if(isAllSame(mainMaxValues) && isAllSame(refMaxValues)) {
        maxResult = (mainMaxValues[0] !== refMaxValues[0]) ? "P" : "B";
      } else {
        maxResult = "B";
      }
      const minPos=getMinOrMaxPos(main,'min');
      const minResult = main[minPos]===ref[minPos]?'P':'B';
      backupDNA.push({dna1:[...dna1],dna2:[...dna2]});if(backupDNA.length>20)backupDNA.shift();
      updateDNA(minResult,maxResult,actual);
    }
    function updateDNA(r1,r2,actual){
      if(dna1.length>=50)dna1.shift(); if(dna2.length>=50)dna2.shift();
      dna1.push(r1===actual?'тЪкя╕П':'ЁЯФ┤'); dna2.push(r2===actual?'тЪкя╕П':'ЁЯФ┤'); renderDNA();
    }
    function renderDNA(){
      document.getElementById('dna1').innerText=dna1.join('');
      document.getElementById('dna2').innerText=dna2.join('');
      document.getElementById('percent1').innerText=`р╕Др╕зр╕▓р╕бр╣Бр╕бр╣Ир╕Щр╕вр╕│:${percent(dna1)}|р╣Бр╕Щр╕зр╣Вр╕Щр╣Йр╕б:${detectPattern(dna1)}`;
      document.getElementById('percent2').innerText=`р╕Др╕зр╕▓р╕бр╣Бр╕бр╣Ир╕Щр╕вр╕│:${percent(dna2)}|р╣Бр╕Щр╕зр╣Вр╕Щр╣Йр╕б:${detectPattern(dna2)}`;
      localStorage.setItem('dnaBackup',JSON.stringify({dna1,dna2}));
    }
    function percent(arr){let ok=arr.filter(e=>'тЪкя╕П'===e).length;return arr.length?((ok/arr.length*100).toFixed(1)+'%'):'-';}
    function detectPattern(arr){const s=arr.map(e=>e==='тЪкя╕П'?'O':'X').join('');
      if(/^(O+|X+)$/.test(s))return'р╕бр╕▒р╕Зр╕Бр╕гр╕вр╕▓р╕з';if(/^(OX){3,}|(XO){3,}$/.test(s))return'р╕Ыр╕┤р╕Зр╕Ыр╕нр╕З';
      if(/^(OOXX|XXOO)+$/.test(s))return'р╕кр╕нр╕Зр╕Хр╕▒р╕Фр╕кр╕нр╕З';if(/^(OOX|XXO){2,}$/.test(s))return'р╕кр╕нр╕Зр╕лр╕Щр╕╢р╣Ир╕З';
      if(/^(OXOXOX)$/.test(s))return'р╕кр╕ер╕▒р╕Ър╕вр╕▓р╕з';if(/^(OOOX|XXXO)$/.test(s))return'р╕кр╕▓р╕бр╕Хр╕▒р╕Ф';
      if(/^(OXOXO)$/.test(s))return'р╕Ыр╕┤р╕Зр╕Ыр╕нр╕Зр╕кр╕▒р╣Йр╕Щ';if(/^(OO|XX)(OX|XO)(OO|XX)$/.test(s))return'р╕кр╕нр╕Зр╕Хр╕▒р╕Фр╕Бр╕ер╕▓р╕З';
      return'р╣Др╕бр╣Ир╣Бр╕Щр╣Ир╕Кр╕▒р╕Ф';}
    function clearDNA(){dna1=[];dna2=[];backupDNA=[];localStorage.removeItem('dnaBackup');renderDNA();}
    function undoDNA(){const last=backupDNA.pop();if(last){dna1=last.dna1;dna2=last.dna2;renderDNA();}}  
  </script>
</body>
</html>
